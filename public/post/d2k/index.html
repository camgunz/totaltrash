<!DOCTYPE html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>:: TotalTrash :: D2K</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet"
          href="/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="/css/bootstrap-slate.min.css">
    <link rel="stylesheet"
          href="/css/main.css">
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="/img/apple-touch-icon-144-precomposed.png">
    <script type="text/javascript"
            src="/js/modernizr-2.6.2-respond-1.1.0.min.js">
    </script>
</head>

<body>
    <!--[if lt IE 8]>
        <p class="browsehappy">
            You are using an <strong>outdated</strong> browser. Please
            <a href="http://browsehappy.com">Upgrade your browser</a> to
            improve your experience.
        </p>
    <![endif]-->
    <div class="navbar navbar-default navbar-static-top" role="navigation"
     id="main-navbar">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">:: TotalTrash ::</a>
        </div>
        <div class="navbar-collapse collapse" id="main-menu">
            <ul class="nav navbar-nav" id="main-menu-left">
                
                    <li class="dropdown">
                
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        D2K<b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu" id="d2k-menu">
                        <li><a href="/d2k">D2K</a></li>
                        <li class="divider"></li>
                        <li><a href="/d2k/goals">Goals</a></li>
                        <li><a href="/d2k/download">Downloads</a>
                        </li>
                        <li>
                            <a href="https://github.com/camgunz/d2k/issues">
                                Issues
                            </a>
                        </li>
                        <li><a href="/d2k/faq">FAQ</a></li>
                        <li><a href="/d2k/building">Building</a> </li>
                    </ul>
                </li>
                
                    <li class="dropdown">
                
                    <a class="dropdown-toggle" data-toggle="dropdown"
                       href="#">Eternity C/S<b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu" id="ee-menu">
                        <li><a href="/eternity">Eternity C/S</a></li>
                        <li class="divider"></li>
                        <li><a href="/eternity/features">Features</a></li>
                        <li><a href="/eternity/download">Downloads</a></li>
                        <li>
                            <a href="https://github.com/camgunz/eternity/issues">
                                Issues
                            </a>
                        </li>
                        <li><a href="/eternity/faq">FAQ</a></li>
                        <li><a href="/eternity/building">Building</a></li>
                    </ul>
                </li>
                
                    <li>
                
                    <a href="/about">About</a>
                </li>
                
                    <li>
                
                    <a href="wads">WADs</a>
                </li>
            </ul>
        </div>
    </div>
</div>


    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 visible-xs visible-sm">
                <img src="/img/ttlogooneline.png"
                     alt="Total Trash"
                     class="logo logo-top center-block"
                />
            </div>
        </div>
        <div class="row">
            <div class="col-md-3 hidden-xs hidden-sm">
                <img src="/img/ttlogo.png"
                     alt="Total Trash"
                     class="logo logo-side" />
            </div>
            <div id="content" class="col-md-8 col-md-offset-1 tt-panel">
                <h2>
                    <a href="http://localhost:1313/post/d2k/">D2K</a>
                </h2>
                <small>
                    Sun Mar 2, 2014
                    
                        in 
                        
                            <a href="/categories/development">development</a>
                    
                    
                        using tags
                        
                            <a href="/tags/d2k">d2k</a>
                    
                </small>
                <div id="content-body">
                    

<p>I&rsquo;ve decided to start working on a new source port called <a href="/d2k">Doom2K</a> or
&ldquo;D2K&rdquo; for short.  My goal is to build a state-of-the-art multiplayer source
port capable of being the standard-bearer for multiplayer Doom.  This, in my
mind, means a couple of things.</p>

<h3 id="toc_0">Message-Based Netcode Is Broken</h3>

<p>ZDaemon, Zandronum, and Odamex all use message-based netcode.  For example,
there is (historically) a function called <code>P_SpawnMobj</code> which spawns a new
actor into the game.  Serverside, inside of <code>P_SpawnMobj</code> is a call to a
function that broadcasts a &ldquo;mobj spawned&rdquo; message; let&rsquo;s call it
<code>SV_BroadcastMobjSpawned</code>.  For illustration&rsquo;s sake, it generally looks
something like this:</p>

<pre><code>---------
| ID    |
---------
| X     |
---------
| Y     |
---------
| Z     |
---------
| Angle |
---------
| Type  |
---------
</code></pre>

<p>This model &ldquo;works&rdquo; for any number of game events.  EECS, for example, has 44
messages.  Odamex has 112.  The way message-based netcode &ldquo;scales up&rdquo; is
message proliferation, and there are a number of downsides to this.</p>

<h4 id="toc_1">You have to litter your code with network messages</h4>

<p>Ugly, error-prone, and overly complicates extending the engine (scripting).</p>

<h4 id="toc_2">You have to exempt huge swaths of code from running clientside</h4>

<p>Same as above.</p>

<h4 id="toc_3">Consistency is complicated</h4>

<p>Unless you package up all your message into a single packet (assuming it will
all fit), consistency requires sequencing and a &ldquo;tic ended&rdquo; message.</p>

<h3 id="toc_4">Doom Scripting Is Busted</h3>

<p>Probably the best scripting out there is Doomsday.  Otherwise, you can use
EDGE/3DGE and COAL, or you can use ZDoom and ACS.  I think you can use
FraggleScript in Legacy.</p>

<p>The situation isn&rsquo;t great though.</p>

<p>With a powerful scripting language, it would be possible to implement new game
modes (like CTF), convert most of Doom&rsquo;s physics and original game play, and
represent assets and configuration in scripting also.  PWO, for example, could
simply be a user-provided function in a config.</p>

<h3 id="toc_5">ASCII Is Out, Unicode Is In</h3>

<p>Unless Doomsday uses UTF-8, I&rsquo;m unaware of any source ports that are
Unicode-aware.  This has serious implications for Doom&rsquo;s popularity outside of
English-speaking countries.</p>

<h3 id="toc_6">Software Rendering Is Limited And Slow</h3>

<p>Software rendering is much slower than hardware-accelerated OpenGL rendering.
In general, people who prefer software rendering do so because it&rsquo;s more
faithful to Doom&rsquo;s original renderer (which almost no port uses anymore, due to
its bugs and limitations).  However, with display pixel count rising, software
rendering is becoming less and less feasible.</p>

<p>Software renderers also have various limitations: lack of support for portals,
3D architecture (slopes, room-over-room, etc.), bad math (wobbling flats,
problems with long walls, inaccurate flat rendering, etc.), and so on.</p>

<h3 id="toc_7">Goals</h3>

<p><a href="/d2k/goals">My major goals are to fix all of this</a>.</p>

<p>Instead of network messages, D2K will use delta-compressed game states, which
avoids all of the problems with message-based netcode (at the expense of
increased CPU usage and RAM consumption).</p>

<p>D2K will use Lua for scripting.  Current plans include:</p>

<ul>
<li>Implement console in scripting</li>
<li>Implement new game modes in scripting</li>
<li>Move Doom physics, game play, and assets to scripting</li>
</ul>

<p>D2K will use UTF-8 instead of ASCII.</p>

<p>Regarding the renderer, I haven&rsquo;t entirely decided to remove the software
renderer.  My main focus will be on the OpenGL renderer, however, because it&rsquo;s
easier to add advanced renderer features to it.  Further, I will work on
implementing a shader for the OpenGL renderer that accurately emulates Doom&rsquo;s
lighting.</p>

                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
    <div class="container">
        &copy; TotalTrash 2014
    </div>
</footer>

    <script type="text/javascript"
        src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
</script>
<script>
    var url = "/js/jquery-1.11.1.min.js"
    window.jQuery || document.write(
        '<script src="' + url + '"<\/script>'
    )
</script>
<script type="text/javascript"
        src="/js/bootstrap.min.js">
</script>

<script src="/js/ie10-viewport-bug-workaround.js">
</script>

<script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
